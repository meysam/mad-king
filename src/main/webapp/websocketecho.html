<html>
<body>
<div>
    <input type="text" id="input"/>
</div>
<div>
    <input type="text" id="uid"/>
</div>
<div>
    <input type="button" id="connectBtn" value="CONNECT"
           onclick="connect()"/> <input type="button" id="sendBtn"
                                        value="SEND" onclick="send()" disabled="true"/>
</div>
<div id="output">
    <p>Output</p>
</div>
</body>

<script type="text/javascript">
    var webSocket;
    var output = document.getElementById("output");
    var connectBtn = document.getElementById("connectBtn");
    var sendBtn = document.getElementById("sendBtn");

    function connect() {
        // oprn the connection if one does not exist
        if (webSocket !== undefined
            && webSocket.readyState !== WebSocket.CLOSED) {
            return;
        }
        // Create a websocket
        webSocket = new WebSocket("ws://localhost:8080/madKing");

        webSocket.onopen = function (event) {
            updateOutputText("Connected!");
            connectBtn.disabled = true;
            sendBtn.disabled = false;

        };

        webSocket.onmessage = function (event) {
            updateOutput(event.data);
        };

        webSocket.onclose = function (event) {
            updateOutputText("Connection Closed");
            connectBtn.disabled = false;
            sendBtn.disabled = true;
        };
    }

    function send() {
        var text = document.getElementById("input").value;
        var uid = document.getElementById("uid").value;
        var message = '{'
            + '"msg" : "' + text + '",'
            + '"uniqueId"  : "' + uid + '"'
            + '}';
        webSocket.send(message);
    }

    function closeSocket() {
        webSocket.close();
    }

    function updateOutputText(text) {
        output.innerHTML += "<br/>" + text;
    }

    function updateOutput(text) {

        var obj = JSON.parse(text, function (key, value) {
            if (key == "uniqueId") {
                document.getElementById("uid").value = value;
                return value;
            } else {
                return value;
            }});
         output.innerHTML += "<br/>" + text;
    }
</script>
</html>
